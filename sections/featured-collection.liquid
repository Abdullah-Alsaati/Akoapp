{{ 'featured-collection.css' | asset_url | stylesheet_tag }}

<section class="featured-collection-wrapper">

  <div class="featured-collection">
    <div class="collection-image">
      <a href="{{ section.settings.featured_collection.url }}" class="collection-name-link">
        <p class="collection-name">{{ section.settings.featured_collection.title }}</p>
      </a>
    </div>

    <!-- Swiper Container -->
    <div class="swiper featured-collection-swiper">
      <div class="swiper-wrapper">
        {% for product in collections[section.settings.featured_collection].products limit: 15 %}
          <div class="swiper-slide">
            <div class="product-card">
              <div class="product-image">
                <img width="100%" height="100%" src="{{ product.featured_image | image_url }}" alt="" loading="lazy">
              </div>
              <div class="product-information">
                <a href="{{ product.url }}">
                  <h2 class="short_title">{{ product.metafields.custom.product_short_title }}</h2>
                  <p class="product-title">{{ product.title | truncatewords: 7 }}</p>
                </a>
                <div class="product-prices">
                  {% if cart.currency.iso_code == "SAR" %}
                    <div class="saudi-price-holder">
                      <p class="product-price">{{ product.price | money_without_currency }}</p>
                      <img width="auto" height="20px" src="{{ 'sar.svg' | asset_url }}" alt="">
                    </div>
                  {% else %}
                    <p class="product-price">{{ product.price | money_with_currency }}</p>
                  {% endif %}

                  {% if product.compare_at_price %}
                    <p class="product-compare-to-price" style="text-decoration: line-through;">
                      {{ product.compare_at_price | money }}
                    </p>
                  {% endif %}
                </div>
              </div>
              <div class="buttons">
                <form class="buttons" method="post" action="/cart/add">
                  <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                  <input type="hidden" name="quantity" value="1">
                  <button type="submit" class="buy-now-button">أشتر الأن</button>
                  <button type="submit" class="add-to-cart-button">
                    <img width="auto" height="100%" src="{{ 'cart.svg' | asset_url }}" alt="">
                  </button>
                </form>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Navigation Buttons -->
      <div class="swiper-button-prev"></div>
      <div class="swiper-button-next"></div>
    </div>
  </div>
</section>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    new Swiper(".featured-collection-swiper", {
      loop: true,
      slidesPerView: 1.2,
      spaceBetween: 15,
      slidesPerGroup: 3,
      breakpoints: {
        10:{
          slidesPerView: 2,
          slidesPerGroup: 1,
        },
        450: {
          slidesPerView: 2,
          slidesPerGroup: 1,
        },
        768: {
          slidesPerView: 3,
          slidesPerGroup: 3,
        },
        1024: {
          slidesPerView: 5,
          slidesPerGroup: 3,
        }
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev"
      },
      grabCursor: true,
      lazyPreloadPrevNext: 2
    });

    // Buy Now button logic
    document.querySelectorAll(".buy-now-button").forEach(button => {
      button.addEventListener("click", function (event) {
        event.preventDefault();
        const form = event.target.closest("form");
        fetch("/cart/add", {
          method: "POST",
          body: new FormData(form)
        }).then(() => {
          window.location.href = "/checkout";
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "featured-collection",
  "settings": [
    {
      "type": "collection",
      "id": "featured_collection",
      "label": "أختر مجموعة منتجات لعرضها"
    }
  ],
  "presets": [
    {
      "name": "featured-collection"
    }
  ]
}
{% endschema %}
